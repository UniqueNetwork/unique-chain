name: Main CI

on:
  pull_request:
    branches:
      - master
      - develop
    types:
      - opened
      - reopened
      - synchronize   #commit(s) pushed to the pull request
      - ready_for_review

concurrency:
  group: ${{ github.workflow }}-${{ github.head_ref }}
  cancel-in-progress: true


jobs:

  prepare-execution-marix:
    uses: ./.github/workflows/generate-execution-matrix.yml
    
  forkless-update-data:
    if: contains( github.event.pull_request.labels.*.name, 'forkless')
    uses: ./.github/workflows/forkless-update-data_v2.yml
    with:
      matrix: ${{ matrix_values.matrix.network }}

  forkless-update-no-data:
    if: contains( github.event.pull_request.labels.*.name, 'forkless')
    uses: ./.github/workflows/forkless-update-nodata_v2.yml

  try-runtime:
    if: contains( github.event.pull_request.labels.*.name, 'forkless')
    uses: ./.github/workflows/try-runtime_v2.yml






# ci.yml  codestyle.yml  dev-build-tests.yml  forkless-update-data.yml  forkless-update-nodata.yml  nodes-only-update.yml  tests_codestyle.yml  try-runtime.yml  unit-test.yml


#Как пример: 
#PR on develop feature-foreighn_assets
#выставляем label xcm
#Результат: помимо осн набора тестов PR на develop дополнительно активируется xcm конвеер
#label: forkless активирует
#           try-runtime
#           forkless upgrade nodata
#           forkless upgrade replica

#label: xcm активирует
#          xcm-unique
#          xcm-quartz
#          xcm-opal

#lable: canary активирует
#          canary marketplace  (отредактировано)
#name: nodes-only update


