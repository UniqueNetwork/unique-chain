version: "3.5"

services:
  node-parachain:
    build:
      args:
        - "RUST_TOOLCHAIN={{ RUST_TOOLCHAIN }}"
        - "BRANCH={{ BRANCH }}"
        - "REPO_URL={{ REPO_URL }}"
        - "NETWORK={{ NETWORK }}"
        - "POLKADOT_BUILD_BRANCH={{ POLKADOT_BUILD_BRANCH }}"
        - "POLKADOT_LAUNCH_BRANCH={{ POLKADOT_LAUNCH_BRANCH }}"
        - "MAINNET_TAG={{ MAINNET_TAG }}"
        - "MAINNET_BRANCH={{ MAINNET_BRANCH }}"
        - "REPLICA_FROM={{ REPLICA_FROM }}"
        - "WASM_NAME={{ WASM_NAME }}"
      context: ../
      dockerfile: .docker/Dockerfile-parachain-upgrade-data
    image: node-parachain
    container_name: node-parachain
    volumes:
       - type: bind
         source: ./launch-config-forkless-data.json
         target: /polkadot-launch/launch-config.json
         read_only: true
       - type: bind
         source: ./forkless-config/fork.jsonnet
         target: /polkadot-launch/fork.jsonnet
         read_only: true
       - type: bind
         source: ./forkless-config/typeNames.jsonnet
         target: /polkadot-launch/typeNames.jsonnet
         read_only: true
    expose:
      - 9944
      - 9933
    ports:
      - 127.0.0.1:9944:9944
      - 127.0.0.1:9933:9933
    logging:
      options:
        max-size: "1m"
        max-file: "3"
