version: "3.5"

services:
  node-o:
    build:
      context: .
      dockerfile: Dockerfile-chain-dev
      args:
        RUST_TOOLCHAIN: nightly-2022-05-11
        BRANCH:  ${{ github.head_ref }}
        FEATURE: opal
        REPO_URL: ${{ github.repositoryUrl }}
    image: node-o
    container_name: node-o
    command: cargo run --release -- --dev -linfo --unsafe-ws-external --rpc-cors=all --unsafe-rpc-external
    expose:
      - 9944
      - 9933
    ports:
      - 127.0.0.1:9944:9944
      - 127.0.0.1:9933:9933
    healthcheck:
      test: curl --fail -s http://localhost:9933/ || exit 1
      interval: 1m30s
      timeout: 10s
      retries: 3
    logging:
      options:
        max-size: "1m"
        max-file: "3"


#  node-q:
#    build:
#      context: .
#      dockerfile: Dockerfile-chain-dev
#      args:
#        RUST_TOOLCHAIN: nightly-2022-05-11
#        BRANCH: release-v924010
#    image: node-q
#    container_name: node-q
#    environment:
#      FEATURE: quartz-runtime
#    expose:
#      - 9944
#      - 9933
#    ports:
#      - 39944:9944
#      - 39933:9933
#    logging:
#      options:
#        max-size: "1m"
#        max-file: "3"
#
#  node-u:
#    build:
#      context: .
#      dockerfile: Dockerfile-chain-dev
#      args:
#        RUST_TOOLCHAIN: nightly-2022-05-11
#        BRANCH: release-v924010
#        FEATURE: unique
#    image: node-u
#    container_name: node-u
#    environment:
#      FEATURE: unique-runtime
#    expose:
#      - 9944
#      - 9933
#    ports:
#      - 49944:9944
#      - 49933:9933
#    logging:
#      options:
#        max-size: "1m"
#        max-file: "3"
